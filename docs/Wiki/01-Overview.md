<!--
SPDX-FileCopyrightText: 2026 DslsDZC <dsls.dzc@gmail.com>

SPDX-License-Identifier: CC-BY-4.0
-->

# 项目概述

## 什么是HIC？

HIC (Hierarchical Isolation Core，分级隔离内核) 是一个新型的操作系统内核，通过统一的架构范式，构建一个能适应从资源受限的嵌入式设备到功能复杂的通用计算系统的操作系统内核。

## 核心目标

HIC的核心目标是在单一架构框架内实现以下三个目标的统一：

1. **极致性能** - 接近宏内核的性能，避免传统微内核的性能开销
2. **强安全隔离** - 基于硬件MMU和软件能力系统的强隔离机制
3. **动态可扩展性** - 支持运行时模块加载和热更新

## 设计哲学

### 1. 机制与策略的彻底分离

- **内核核心（Core-0）** 仅提供原子化的、无策略的执行原语、隔离机制和能力系统
- **Privileged-1层** 所有系统策略和功能实现均由可加载模块化服务提供
- **配置方式** 通过构建时配置或运行时动态管理进行定制

### 2. 逻辑三级特权架构

HIC构建逻辑上的三级控制流：

| 层级 | 名称 | 特权级 | 角色 |
|------|------|--------|------|
| Core-0 | 内核核心与仲裁者 | Ring 0 | 系统的可信计算基（TCB） |
| Privileged-1 | 特权服务沙箱 | 逻辑Ring 1，物理Ring 0 | 模块化的系统功能提供者 |
| Application-3 | 应用层 | Ring 3 | 不可信用户代码 |

### 3. 统一架构，弹性部署

同一套架构同时支持两种部署模式：

#### 静态合成模式
- **适用场景**: 嵌入式、实时或高安全场景
- **特点**:
  - 所有服务模块在构建时编译并链接为单一、确定性的内核映像
  - 无运行时模块加载开销
  - 极致确定性，适合功能安全（FuSa）认证
  - 最小化存储占用

#### 动态模块化模式
- **适用场景**: 通用计算、桌面或服务器场景
- **特点**:
  - 核心服务静态编译，扩展服务可在运行时通过网络仓库安全地安装、更新和卸载
  - 高度灵活，用户可根据硬件和外设动态安装所需驱动和功能
  - 支持滚动更新，零停机升级
  - 存储效率高，基础映像小巧

### 4. 强向后兼容与API演化

- **稳定ABI**: 系统内核与Privileged-1服务提供稳定的用户态ABI
- **透明兼容**: 通过模块化服务和用户态兼容库，在支持新API的同时，透明地提供对旧版API的完整兼容
- **长期稳定**: 保障应用生态的长期稳定

## 核心特性

### 1. 物理内存直接映射

Privileged-1服务采用物理内存直接映射方案：

- **无虚拟地址空间**: 服务直接使用物理地址，无额外的虚拟地址转换开销
- **物理空间隔离**: 不同服务的物理内存区域通过MMU页表权限相互隔离
- **确定延迟**: 消除虚拟内存管理的非确定性和性能开销

### 2. 能力系统

能力（Capability）是HIC中所有授权的载体：

- **不可伪造**: 能力是不可伪造的内核对象
- **细粒度权限**: 描述对系统资源的特定访问权限（读、写、执行）
- **动态传递**: 支持能力在域间传递、派生（创建权限子集）、撤销
- **安全验证**: 所有资源访问都必须通过能力验证

### 3. 强隔离机制

- **硬件MMU隔离**: 每个服务运行在独立的物理内存区域，通过MMU强制隔离
- **故障隔离**: 服务的崩溃被限制在其自身物理地址空间内，不影响其他服务
- **资源隔离**: 每个服务有硬性的资源配额限制，防止单个服务耗尽系统资源

### 4. 模块化服务架构

- **独立沙箱**: 每个服务运行在独立的Privileged-1沙箱中
- **热插拔支持**: 支持运行时安全地加载、更新、卸载服务模块
- **滚动更新**: 支持零停机的服务升级
- **API版本管理**: 支持同一服务的多个API版本实现并存

## 性能目标

基于架构设计的理论预期值：

| 指标 | 目标值 | 说明 |
|------|--------|------|
| 系统调用延迟 | 20-30ns | 无特权级切换，无页表切换 |
| 中断处理延迟 | 0.5-1μs | 简化入口，静态路由表直接调用 |
| 线程切换延迟 | 120-150ns | 同特权级切换，无需切换页表 |
| 通信带宽 | 无额外开销 | 零拷贝共享内存通信 |

## 安全特性

### 1. 安全启动

- **信任链**: 从固件到内核的完整信任链
- **签名验证**: RSA-3072 + SHA-384签名验证
- **抗回滚**: 版本号检查，防止降级攻击

### 2. 审计日志

- **完整记录**: 记录所有关键安全操作
- **防篡改**: 仅追加审计日志缓冲区，其他服务无法写入
- **持久化**: 定期加密写入持久存储

### 3. 形式化验证

- **数学证明**: 核心不变式的数学证明
- **可验证性**: 代码规模<10,000行，可形式化验证
- **安全保证**: 提供形式化的安全保证

## 应用场景

### 1. 嵌入式系统

- **IoT节点**: 资源受限的物联网设备
- **传感器网络**: 分布式传感器系统
- **实时控制**: 工业自动化和实时控制系统

### 2. 通用计算

- **桌面系统**: 个人计算机和工作站
- **服务器**: Web服务器、数据库服务器
- **云计算**: 云平台和虚拟化环境

### 3. 安全关键系统

- **航空航天**: 航空电子系统
- **汽车电子**: 自动驾驶系统
- **医疗设备**: 医疗监护设备

## 与其他内核的对比

| 特性 | Linux宏内核 | seL4微内核 | Windows混合内核 | HIC分级隔离内核 |
|------|-------------|-----------|-----------------|-----------------|
| 驱动/服务位置 | 内核空间 | 用户空间 | 混合 | 特权服务沙箱 |
| 核心隔离机制 | 无 | 硬件特权级+IPC | 部分隔离 | MMU+能力系统 |
| 性能关键路径 | 最优 | 开销大 | 折衷 | 接近宏内核 |
| 驱动故障影响 | 内核崩溃 | 局部影响 | 部分影响 | 单一服务崩溃 |
| TCB大小 | 极大 | 极小 | 较大 | 小 |
| 动态支持 | 灵活 | 灵活 | 灵活 | 混合 |
| 确定性 | 低 | 高 | 中等 | 高 |
| 资源DoS防护 | 弱 | 强 | 中等 | 强 |
| API兼容性演进 | 依赖glibc | 用户态库 | 兼容层 | 系统化支持 |

## 项目里程碑

- ✅ **v0.1.0** (2026-02-14) - 初始版本
  - 完成三层模型架构
  - 实现能力系统和审计日志
  - 完成UEFI和BIOS双引导
  - 完整的形式化验证

## 未来计划

- **v0.2.0** - 性能优化和基准测试
- **v0.3.0** - ARM64完整支持
- **v0.4.0** - RISC-V完整支持
- **v0.5.0** - Application-3层和示例应用
- **v1.0.0** - 生产就绪版本

## 参与贡献

欢迎贡献代码、文档、测试用例或提出建议！

详见[贡献指南](./39-Contributing.md)。

## 许可证

GPL-2.0 License - 详见 [LICENSE](../../LICENSE)

---

*最后更新: 2026-02-14*