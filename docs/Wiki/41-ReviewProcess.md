<!--
SPDX-FileCopyrightText: 2026 * <dsls.dzc@gmail.com>

SPDX-License-Identifier: CC-BY-4.0
-->

# 代码审查流程

## 概述

本文档描述了 HIC 项目的代码审查流程，确保代码质量和一致性。

## 审查原则

### 1. 代码质量

- 遵循 [编码规范](./06-CodingStandards.md)
- 代码清晰易读
- 适当的错误处理
- 充分的测试覆盖

### 2. 安全性

- 验证所有输入
- 正确使用能力系统
- 避免信息泄露
- 无安全漏洞

### 3. 性能

- 不显著降低性能
- 优化热点路径
- 避免不必要的拷贝
- 合理使用缓存

### 4. 文档

- 添加必要的注释
- 更新相关文档
- 提供清晰的提交消息
- 包含测试用例

## 审查流程

### 1. 提交 Pull Request

- 创建功能分支
- 完成开发和测试
- 推送到远程仓库
- 创建 Pull Request

### 2. 自动检查

```yaml
# CI 自动检查
- 代码风格检查
- 静态分析
- 单元测试
- 集成测试
- 构建验证
```

### 3. 人工审查

#### 初步审查

```markdown
- 代码是否符合编码规范？
- 是否有充分的测试？
- 文档是否完整？
- 提交消息是否清晰？
```

#### 深度审查

```markdown
- 逻辑是否正确？
- 边界条件是否处理？
- 错误处理是否完整？
- 是否有性能问题？
- 是否有安全隐患？
```

### 4. 审查反馈

#### 批准

```markdown
✅ 通过
- 代码质量良好
- 测试充分
- 文档完整
```

#### 请求更改

```markdown
❌ 需要更改

1. 问题 1: 描述
   - 位置: file.c:123
   - 建议: 具体建议

2. 问题 2: 描述
   - 位置: file.c:456
   - 建议: 具体建议
```

### 5. 修改和更新

- 根据反馈修改代码
- 更新测试和文档
- 推送更新
- 重新请求审查

### 6. 合并

```markdown
合并条件：
✅ 至少一个批准
✅ 通过所有 CI 检查
✅ 解决所有审查意见
✅ 无合并冲突
```

## 审查检查清单

### 代码质量

- [ ] 遵循编码规范
- [ ] 命名清晰一致
- [ ] 函数简洁（< 50 行）
- [ ] 避免重复代码

### 错误处理

- [ ] 检查返回值
- [ ] 处理边界条件
- [ ] 验证输入参数
- [ ] 避免资源泄漏

### 安全性

- [ ] 验证能力权限
- [ ] 清除敏感数据
- [ ] 避免信息泄露
- [ ] 正确处理并发

### 性能

- [ ] 避免不必要的拷贝
- [ ] 优化热点路径
- [ ] 合理使用缓存
- [ ] 减少锁竞争

### 测试

- [ ] 单元测试覆盖
- [ ] 边界条件测试
- [ ] 错误情况测试
- [ ] 集成测试

### 文档

- [ ] 函数注释完整
- [ ] 复杂逻辑有说明
- [ ] 更新相关文档
- [ ] 清晰的提交消息

## 审查角色

### 作者

- 确保代码质量
- 编写充分测试
- 提供清晰描述
- 响应审查意见

### 审查者

- 及时审查代码
- 提供建设性反馈
- 遵循审查原则
- 保持专业态度

### 维护者

- 合并高质量代码
- 维护代码标准
- 引导社区成长
- 解决争议

## 审查工具

### GitHub Review

```markdown
// 行内评论
建议: 这里可以优化为快速路径

// 单个文件审查
文件整体结构清晰，逻辑正确

// 整体审查
PR 质量良好，可以合并
```

### 代码风格检查

```bash
# 检查代码风格
./scripts/check_style.sh

# 自动格式化
./scripts/format.sh
```

### 静态分析

```bash
# 运行静态分析
./scripts/analyze.sh

# 检查常见问题
- 空指针解引用
- 内存泄漏
- 未使用的变量
```

## 最佳实践

### 审查者

1. **及时审查**: 在 24-48 小时内响应
2. **建设性反馈**: 提供具体的改进建议
3. **关注重点**: 优先关注功能和逻辑
4. **尊重作者**: 保持友好和专业的态度

### 作者

1. **小而频繁**: 保持 PR 小而专注
2. **清晰描述**: 充分说明变更原因
3. **及时响应**: 快速响应审查意见
4. **学习改进**: 从审查中学习

## 相关文档

- [贡献指南](./39-Contributing.md) - 贡献指南
- [提交指南](./40-CommitGuidelines.md) - 提交指南
- [编码规范](./06-CodingStandards.md) - 编码规范

---

*最后更新: 2026-02-14*